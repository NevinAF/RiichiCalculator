namespace RiichiCalculator
{
    public static partial class WinCatalog
    {
        [Winnable(
            NameEN = "Melded Simples Triplet",
            Desc = "Awarded for each open triplet made from simples (numbered tiles 2-8).",
            ClosedHand = ScoreBasis.TwoFu,
            OpenHand = ScoreBasis.TwoFu
        )]
        public const int MeldedSimplesTriplet = 52;

        [Winnable(
            NameEN = "Melded Simples Triplet (x2)",
            Desc = "Awarded for each open triplet made from simples (numbered tiles 2-8).",
            ClosedHand = ScoreBasis.TwoFu,
            OpenHand = ScoreBasis.TwoFu
        )]
        public const int MeldedSimplesTriplet_x2 = MeldedSimplesTriplet + 1;

        [Winnable(
            NameEN = "Melded Simples Triplet (x3)",
            Desc = "Awarded for each open triplet made from simples (numbered tiles 2-8).",
            ClosedHand = ScoreBasis.TwoFu,
            OpenHand = ScoreBasis.TwoFu
        )]
        public const int MeldedSimplesTriplet_x3 = MeldedSimplesTriplet + 2;

        [Winnable(
            NameEN = "Melded Simples Triplet (x4)",
            Desc = "Awarded for each open triplet made from simples (numbered tiles 2-8).",
            ClosedHand = ScoreBasis.TwoFu,
            OpenHand = ScoreBasis.TwoFu
        )]
        public const int MeldedSimplesTriplet_x4 = MeldedSimplesTriplet + 3;

        [Winnable(
            NameEN = "Melded Terminal/Honor Triplet",
            Desc = "Awarded for each open triplet made from terminal (1, 9) or honor tiles.",
            ClosedHand = ScoreBasis.FourFu,
            OpenHand = ScoreBasis.FourFu
        )]
        public const int MeldedTerminalHonorTriplet = 56;

        [Winnable(
            NameEN = "Melded Terminal/Honor Triplet (x2)",
            Desc = "Awarded for each open triplet made from terminal (1, 9) or honor tiles.",
            ClosedHand = ScoreBasis.FourFu,
            OpenHand = ScoreBasis.FourFu
        )]
        public const int MeldedTerminalHonorTriplet_x2 = MeldedTerminalHonorTriplet + 1;

        [Winnable(
            NameEN = "Melded Terminal/Honor Triplet (x3)",
            Desc = "Awarded for each open triplet made from terminal (1, 9) or honor tiles.",
            ClosedHand = ScoreBasis.FourFu,
            OpenHand = ScoreBasis.FourFu
        )]
        public const int MeldedTerminalHonorTriplet_x3 = MeldedTerminalHonorTriplet + 2;

        [Winnable(
            NameEN = "Melded Terminal/Honor Triplet (x4)",
            Desc = "Awarded for each open triplet made from terminal (1, 9) or honor tiles.",
            ClosedHand = ScoreBasis.FourFu,
            OpenHand = ScoreBasis.FourFu
        )]
        public const int MeldedTerminalHonorTriplet_x4 = MeldedTerminalHonorTriplet + 3;

        [Winnable(
            NameEN = "Concealed Simples Triplet",
            Desc = "Awarded for each closed triplet made from simples (numbered tiles 2-8).",
            ClosedHand = ScoreBasis.FourFu,
            OpenHand = ScoreBasis.FourFu
        )]
        public const int ConcealedSimplesTriplet = 60;

        [Winnable(
            NameEN = "Concealed Simples Triplet (x2)",
            Desc = "Awarded for each closed triplet made from simples (numbered tiles 2-8).",
            ClosedHand = ScoreBasis.FourFu,
            OpenHand = ScoreBasis.FourFu
        )]
        public const int ConcealedSimplesTriplet_x2 = ConcealedSimplesTriplet + 1;

        [Winnable(
            NameEN = "Concealed Simples Triplet (x3)",
            Desc = "Awarded for each closed triplet made from simples (numbered tiles 2-8).",
            ClosedHand = ScoreBasis.FourFu,
            OpenHand = ScoreBasis.FourFu
        )]
        public const int ConcealedSimplesTriplet_x3 = ConcealedSimplesTriplet + 2;

        [Winnable(
            NameEN = "Concealed Simples Triplet (x4)",
            Desc = "Awarded for each closed triplet made from simples (numbered tiles 2-8).",
            ClosedHand = ScoreBasis.FourFu,
            OpenHand = ScoreBasis.FourFu
        )]
        public const int ConcealedSimplesTriplet_x4 = ConcealedSimplesTriplet + 3;

        [Winnable(
            NameEN = "Concealed Terminal/Honor Triplet",
            Desc = "Awarded for each closed triplet made from terminal (1, 9) or honor tiles.",
            ClosedHand = ScoreBasis.EightFu,
            OpenHand = ScoreBasis.EightFu
        )]
        public const int ConcealedTerminalHonorTriplet = 64;

        [Winnable(
            NameEN = "Concealed Terminal/Honor Triplet (x2)",
            Desc = "Awarded for each closed triplet made from terminal (1, 9) or honor tiles.",
            ClosedHand = ScoreBasis.EightFu,
            OpenHand = ScoreBasis.EightFu
        )]
        public const int ConcealedTerminalHonorTriplet_x2 = ConcealedTerminalHonorTriplet + 1;

        [Winnable(
            NameEN = "Concealed Terminal/Honor Triplet (x3)",
            Desc = "Awarded for each closed triplet made from terminal (1, 9) or honor tiles.",
            ClosedHand = ScoreBasis.EightFu,
            OpenHand = ScoreBasis.EightFu
        )]
        public const int ConcealedTerminalHonorTriplet_x3 = ConcealedTerminalHonorTriplet + 2;

        [Winnable(
            NameEN = "Concealed Terminal/Honor Triplet (x4)",
            Desc = "Awarded for each closed triplet made from terminal (1, 9) or honor tiles.",
            ClosedHand = ScoreBasis.EightFu,
            OpenHand = ScoreBasis.EightFu
        )]
        public const int ConcealedTerminalHonorTriplet_x4 = ConcealedTerminalHonorTriplet + 3;

        [Winnable(
            NameEN = "Melded Simples Quad",
            Desc = "Awarded for each open quad made from simples (numbered tiles 2-8).",
            ClosedHand = ScoreBasis.EightFu,
            OpenHand = ScoreBasis.EightFu
        )]
        public const int MeldedSimplesQuad = 68;

        [Winnable(
            NameEN = "Melded Simples Quad (x2)",
            Desc = "Awarded for each open quad made from simples (numbered tiles 2-8).",
            ClosedHand = ScoreBasis.EightFu,
            OpenHand = ScoreBasis.EightFu
        )]
        public const int MeldedSimplesQuad_x2 = MeldedSimplesQuad + 1;

        [Winnable(
            NameEN = "Melded Simples Quad (x3)",
            Desc = "Awarded for each open quad made from simples (numbered tiles 2-8).",
            ClosedHand = ScoreBasis.EightFu,
            OpenHand = ScoreBasis.EightFu
        )]
        public const int MeldedSimplesQuad_x3 = MeldedSimplesQuad + 2;

        [Winnable(
            NameEN = "Melded Simples Quad (x4)",
            Desc = "Awarded for each open quad made from simples (numbered tiles 2-8).",
            ClosedHand = ScoreBasis.EightFu,
            OpenHand = ScoreBasis.EightFu
        )]
        public const int MeldedSimplesQuad_x4 = MeldedSimplesQuad + 3;

        [Winnable(
            NameEN = "Melded Terminal/Honor Quad",
            Desc = "Awarded for each open quad made from terminal (1, 9) or honor tiles.",
            ClosedHand = ScoreBasis.SixteenFu,
            OpenHand = ScoreBasis.SixteenFu
        )]
        public const int MeldedTerminalHonorQuad = 72;

        [Winnable(
            NameEN = "Melded Terminal/Honor Quad (x2)",
            Desc = "Awarded for each open quad made from terminal (1, 9) or honor tiles.",
            ClosedHand = ScoreBasis.SixteenFu,
            OpenHand = ScoreBasis.SixteenFu
        )]
        public const int MeldedTerminalHonorQuad_x2 = MeldedTerminalHonorQuad + 1;

        [Winnable(
            NameEN = "Melded Terminal/Honor Quad (x3)",
            Desc = "Awarded for each open quad made from terminal (1, 9) or honor tiles.",
            ClosedHand = ScoreBasis.SixteenFu,
            OpenHand = ScoreBasis.SixteenFu
        )]
        public const int MeldedTerminalHonorQuad_x3 = MeldedTerminalHonorQuad + 2;

        [Winnable(
            NameEN = "Melded Terminal/Honor Quad (x4)",
            Desc = "Awarded for each open quad made from terminal (1, 9) or honor tiles.",
            ClosedHand = ScoreBasis.SixteenFu,
            OpenHand = ScoreBasis.SixteenFu
        )]
        public const int MeldedTerminalHonorQuad_x4 = MeldedTerminalHonorQuad + 3;

        [Winnable(
            NameEN = "Concealed Simples Quad",
            Desc = "Awarded for each closed quad made from simples (numbered tiles 2-8).",
            ClosedHand = ScoreBasis.SixteenFu,
            OpenHand = ScoreBasis.SixteenFu
        )]
        public const int ConcealedSimplesQuad = 76;

        [Winnable(
            NameEN = "Concealed Simples Quad (x2)",
            Desc = "Awarded for each closed quad made from simples (numbered tiles 2-8).",
            ClosedHand = ScoreBasis.SixteenFu,
            OpenHand = ScoreBasis.SixteenFu
        )]
        public const int ConcealedSimplesQuad_x2 = ConcealedSimplesQuad + 1;

        [Winnable(
            NameEN = "Concealed Simples Quad (x3)",
            Desc = "Awarded for each closed quad made from simples (numbered tiles 2-8).",
            ClosedHand = ScoreBasis.SixteenFu,
            OpenHand = ScoreBasis.SixteenFu
        )]
        public const int ConcealedSimplesQuad_x3 = ConcealedSimplesQuad + 2;

        [Winnable(
            NameEN = "Concealed Simples Quad (x4)",
            Desc = "Awarded for each closed quad made from simples (numbered tiles 2-8).",
            ClosedHand = ScoreBasis.SixteenFu,
            OpenHand = ScoreBasis.SixteenFu
        )]
        public const int ConcealedSimplesQuad_x4 = ConcealedSimplesQuad + 3;

        [Winnable(
            NameEN = "Concealed Terminal/Honor Quad",
            Desc = "Awarded for each closed quad made from terminal (1, 9) or honor tiles.",
            ClosedHand = ScoreBasis.ThirtyTwoFu,
            OpenHand = ScoreBasis.ThirtyTwoFu
        )]
        public const int ConcealedTerminalHonorQuad = 80;

        [Winnable(
            NameEN = "Concealed Terminal/Honor Quad (x2)",
            Desc = "Awarded for each closed quad made from terminal (1, 9) or honor tiles.",
            ClosedHand = ScoreBasis.ThirtyTwoFu,
            OpenHand = ScoreBasis.ThirtyTwoFu
        )]
        public const int ConcealedTerminalHonorQuad_x2 = ConcealedTerminalHonorQuad + 1;

        [Winnable(
            NameEN = "Concealed Terminal/Honor Quad (x3)",
            Desc = "Awarded for each closed quad made from terminal (1, 9) or honor tiles.",
            ClosedHand = ScoreBasis.ThirtyTwoFu,
            OpenHand = ScoreBasis.ThirtyTwoFu
        )]
        public const int ConcealedTerminalHonorQuad_x3 = ConcealedTerminalHonorQuad + 2;

        [Winnable(
            NameEN = "Concealed Terminal/Honor Quad (x4)",
            Desc = "Awarded for each closed quad made from terminal (1, 9) or honor tiles.",
            ClosedHand = ScoreBasis.ThirtyTwoFu,
            OpenHand = ScoreBasis.ThirtyTwoFu
        )]
        public const int ConcealedTerminalHonorQuad_x4 = ConcealedTerminalHonorQuad + 3;
    }

    internal unsafe ref partial struct Winnables
    {
        public readonly Wins SetsMinipoints()
        {
            int melded_simples_triplet = 0;
            int melded_terminal_honor_triplet = 0;
            int melded_simples_quad = 0;
            int melded_terminal_honor_quad = 0;
            int concealed_simples_triplet = 0;
            int concealed_terminal_honor_triplet = 0;
            int concealed_simples_quad = 0;
            int concealed_terminal_honor_quad = 0;

            int sets = 0;
            for (int meld = 0; meld < Player.Melds.Length; meld++)
            {
                // Missing the fourth tile is ok because we can check for 'back' for concealed quads, otherwise it has to be open.
                TileFlags set = Player.Melds[meld].GetFlags();
                if (set.RepresentsSet())
                {
                    bool simples = set.HasAnyOf(TileFlags.Simples);
                    // int index = melds->GetLength(meld) != 4
                    //     ? (!set.HasExactlyOneOf(TileFlags.Seats) // Checks if uses other seats (open)
                    //         ? (simples ? WinCatalog.MeldedSimplesTriplet : WinCatalog.MeldedTerminalHonorTriplet)
                    //         : (simples ? WinCatalog.ConcealedSimplesTriplet : WinCatalog.ConcealedTerminalHonorTriplet))
                    //     : (!set.HasFlag(TileFlags.Back) // Same as checking if open, but a little faster
                    //         ? (simples ? WinCatalog.MeldedSimplesQuad : WinCatalog.MeldedTerminalHonorQuad)
                    //         : (simples ? WinCatalog.ConcealedSimplesQuad : WinCatalog.ConcealedTerminalHonorQuad));
                    if (Player.Melds[meld].Length != 4)
                    {
                        if (!set.HasExactlyOneOf(TileFlags.Seats)) // Checks if uses other seats (open)
                        {
                            if (simples) melded_simples_triplet++;
                            else melded_terminal_honor_triplet++;
                        }
                        else
                        {
                            if (simples) concealed_simples_triplet++;
                            else concealed_terminal_honor_triplet++;
                        }
                    }
                    else {
                        if (!set.HasFlag(TileFlags.Back)) // Same as checking if open, but a little faster
                        {
                            if (simples) melded_simples_quad++;
                            else melded_terminal_honor_quad++;
                        }
                        else
                        {
                            if (simples) concealed_simples_quad++;
                            else concealed_terminal_honor_quad++;
                        }
                    }

                    sets++;
                }
            }

            for (; sets < Sets.Length; sets++)
            {
                TileFlags set = Sets[sets]; // must be closed triplet.
                bool simples = set.HasAnyOf(TileFlags.Simples);
                if (!set.HasExactlyOneOf(TileFlags.Seats)) // Checks if uses other seats (open)
                {
                    if (simples) melded_simples_triplet++;
                    else melded_terminal_honor_triplet++;
                }
                else
                {
                    if (simples) concealed_simples_triplet++;
                    else concealed_terminal_honor_triplet++;
                }
            }

            Wins result = WinCatalog.None;

            if (melded_simples_triplet > 0) result |= WinCatalog.MeldedSimplesTriplet + melded_simples_triplet - 1;
            if (melded_terminal_honor_triplet > 0) result |= WinCatalog.MeldedTerminalHonorTriplet + melded_terminal_honor_triplet - 1;
            if (melded_simples_quad > 0) result |= WinCatalog.MeldedSimplesQuad + melded_simples_quad - 1;
            if (melded_terminal_honor_quad > 0) result |= WinCatalog.MeldedTerminalHonorQuad + melded_terminal_honor_quad - 1;
            if (concealed_simples_triplet > 0) result |= WinCatalog.ConcealedSimplesTriplet + concealed_simples_triplet - 1;
            if (concealed_terminal_honor_triplet > 0) result |= WinCatalog.ConcealedTerminalHonorTriplet + concealed_terminal_honor_triplet - 1;
            if (concealed_simples_quad > 0) result |= WinCatalog.ConcealedSimplesQuad + concealed_simples_quad - 1;
            if (concealed_terminal_honor_quad > 0) result |= WinCatalog.ConcealedTerminalHonorQuad + concealed_terminal_honor_quad - 1;

            return result;
        }
    }
}